{"ast":null,"code":"var _jsxFileName = \"/Users/amloewi/Code/ladder-of-babel/src/App.js\";\nimport React, { useState } from 'react';\nimport './App.css';\nimport { cedict } from \"./medium.js\"; // do one for medium w ... 50k\n\nimport '../node_modules/bootstrap/dist/css/bootstrap.min.css'; // This was necessary; ugh\n\nimport { Container, Row, Col, Navbar, Button, Nav, Modal, InputGroup, FormControl } from 'react-bootstrap';\nimport axios from 'axios';\nimport { Auth0Provider, useAuth0 } from \"@auth0/auth0-react\"; // dev-lstkwpc9.us.auth0.com # DOMAIN\n// AK5e52F3h6Goesct1Q9ADvHuPchBW25U # CLIENT ID\n\nclass Translation extends React.Component {\n  constructor(props) {\n    super(props);\n    const translation = [{\n      \"word\": \"在\",\n      \"pinyin\": \"[zai4]\",\n      \"definition\": \"/(located) at/(to be) in/to exist/in the middle of doing sth/(indicating an action in progress)/\"\n    }, {\n      \"word\": \"此\",\n      \"pinyin\": \"[ci3]\",\n      \"definition\": \"/this/these/\"\n    }, {\n      \"word\": \"粘贴\",\n      \"pinyin\": \"[zhan1 tie1]\",\n      \"definition\": \"/to stick/to affix/to adhere/to paste (as in 'copy and paste')/Taiwan pr. [nian2 tie1]/also written 黏貼|黏贴[nian2 tie1]/\"\n    }, {\n      \"word\": \"你\",\n      \"pinyin\": \"[ni3]\",\n      \"definition\": \"/you (informal, as opposed to courteous 您[nin2])/\"\n    }, {\n      \"word\": \"自己\",\n      \"pinyin\": \"[zi4 ji3]\",\n      \"definition\": \"/oneself/one's own/\"\n    }, {\n      \"word\": \"的\",\n      \"pinyin\": \"[de5]\",\n      \"definition\": \"/of/~'s (possessive particle)/(used after an attribute)/(used to form a nominal expression)/(used at the end of a declarative sentence for emphasis)/\"\n    }, {\n      \"word\": \"内容\",\n      \"pinyin\": \"[nei4 rong2]\",\n      \"definition\": \"/content/substance/details/CL:個|个[ge4],項|项[xiang4]/\"\n    }, {\n      \"word\": \"!\",\n      \"pinyin\": \"\",\n      \"definition\": \"\"\n    }]; // IS IT BECAUSE THE MEANING OF 'this' IS CHANGING INSIDE OF THE CALL???\n    // Well don't know, but putting this outside (as the default)\n    // and only conditionally doing the authenticated version worked.\n\n    this.state = {\n      translation: translation,\n      text: \"在此粘贴你自己的内容!\",\n      known: 0,\n      unknown: translation.length,\n      vocabulary: []\n    };\n\n    if (this.props.authenticated) {\n      // console.log(\"Set state YES authenticated\")\n      axios.get(\"https://ladder-pipenv.herokuapp.com/api/private/\" + this.props.user + \"/mandarin\").then(result => {\n        // console.log(\"result.data:\", result.data)\n        const updated = translation.map(word => {\n          if (result.data.includes(word)) {\n            return { ...word,\n              show: \"hidden\"\n            };\n          } else {\n            return word;\n          }\n        });\n        this.state = {\n          translation: updated,\n          text: \"在此粘贴你自己的内容!\",\n          vocabulary: result.data,\n          known: result.data.length,\n          unknown: updated.map(word => word[\"show\"] !== \"hidden\").reduce((a, b) => a + b)\n        };\n      });\n    } // Would prefer the less insane syntax for this\n\n\n    this.handleInputChange = this.handleInputChange.bind(this); // Why again do I need to declare this, and not 'toggle'? B/c event?\n  }\n\n  handleInputChange(event) {\n    // event.persist()\n    const e = event.target.value;\n\n    if (this.props.authenticated) {\n      axios.get(\"https://ladder-pipenv.herokuapp.com/api/private/\" + this.props.user + \"/mandarin\").then(result => {\n        this.setState({\n          vocabulary: result.data,\n          // yes! This works!\n          text: e,\n          // vent.target.value,\n          known: result.data.length,\n          translation: this.translate(e).map((word, j) => {\n            if (result.data.includes(word.word)) {\n              return { ...word,\n                show: \"hidden\"\n              };\n            } else {\n              return { ...word,\n                show: \"\"\n              };\n            }\n          })\n        });\n      });\n    } else {\n      this.setState({\n        // vocabulary: result.data, // yes! This works!\n        text: e,\n        // vent.target.value,\n        known: 0,\n        // result.data.length,\n        translation: this.translate(e)\n      });\n    }\n  }\n\n  toggle(ix) {\n    const updated = this.state.translation.map((word, j) => {\n      if (ix === j) {\n        return { ...word,\n          show: word.show === \"hidden\" ? \"\" : \"hidden\"\n        };\n      } else {\n        return word;\n      }\n    });\n    const known = this.state.known + 1 * (updated[ix].show === \"hidden\") + -1 * (updated[ix].show !== \"hidden\");\n    this.setState({\n      translation: updated,\n      known: known,\n      unknown: updated.map(word => word[\"show\"] !== \"hidden\").reduce((a, b) => a + b)\n    });\n\n    if (this.props.authenticated) {\n      // https://ladder-pipenv.herokuapp.com/\n      // http://127.0.0.1:5000/api/private/\n      axios.post(\"https://ladder-pipenv.herokuapp.com/api/private/\" + this.props.user + \"/mandarin/\" + this.state.translation[ix].word //,\n      // {\n      //   headers: {\n      //     Authorization: `Bearer ${token}`,\n      //   }\n      // }\n      );\n    }\n  } // Shit -- this should be calling the database too at ... /language/word, to just get it? \n\n\n  translate(text) {\n    const translation = [];\n    let remaining_characters = text;\n\n    while (remaining_characters.length > 0) {\n      let word_boundary = 1;\n      let best_candidate = null;\n\n      while (remaining_characters.length > 0) {\n        const candidate = remaining_characters.slice(0, word_boundary);\n\n        if (candidate in cedict && word_boundary <= remaining_characters.length) {\n          best_candidate = candidate;\n          word_boundary += 1;\n        } else {\n          // candidate is NOT in the dictionary\n          if (best_candidate != null) {\n            // at least the first character was recognized\n            const line = String(cedict[best_candidate]);\n            const pinyin = line.split(/](.+)/)[0] + \"]\"; // I only want to split on the FIRST ']'; \n\n            const definition = line.split(/](.+)/)[1].slice(1);\n            translation.push({\n              \"word\": best_candidate,\n              \"pinyin\": pinyin,\n              \"definition\": definition\n            });\n          } else {\n            const word = remaining_characters[0];\n            translation.push({\n              \"word\": word,\n              \"pinyin\": \"\",\n              \"definition\": \"\"\n            });\n          }\n\n          if (word_boundary > 1) {\n            remaining_characters = remaining_characters.slice(word_boundary - 1);\n          } else {\n            remaining_characters = remaining_characters.slice(word_boundary);\n          }\n\n          break;\n        }\n      }\n    }\n\n    return translation;\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(Container, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Row, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Col, {\n      md: {\n        span: 3,\n        offset: 9\n      },\n      className: \"fixed-top\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      variant: \"dark\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 13\n      }\n    }, \"Click to hide familiar words\"), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 163,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"h5\", {\n      style: {\n        paddingTop: 10 + \"px\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 164,\n        columnNumber: 13\n      }\n    }, \"You knew \", this.state.known, \" words,\"), /*#__PURE__*/React.createElement(\"h5\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 13\n      }\n    }, \"and saw \", this.state.unknown, \" new ones!\"))), /*#__PURE__*/React.createElement(Row, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Col, {\n      md: 10,\n      className: \"textinput\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(InputGroup, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(InputGroup.Prepend, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(InputGroup.Text, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 17\n      }\n    }, \"Paste Chinese Here\")), /*#__PURE__*/React.createElement(FormControl, {\n      onChange: this.handleInputChange,\n      value: this.state.text,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 15\n      }\n    })), \"\\xA0\\xA0\")), this.state.translation.map((word, ix) => /*#__PURE__*/React.createElement(Row, {\n      key: ix,\n      style: {\n        textAlign: \"left\"\n      },\n      onClick: () => this.toggle(ix),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Col, {\n      md: 1,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 13\n      }\n    }, word[\"word\"]), /*#__PURE__*/React.createElement(Col, {\n      md: 2,\n      className: word[\"show\"],\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 13\n      }\n    }, word[\"pinyin\"]), /*#__PURE__*/React.createElement(Col, {\n      md: 8,\n      className: word[\"show\"],\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 13\n      }\n    }, word[\"definition\"]))));\n  }\n\n}\n\nfunction About() {\n  const [show, setShow] = useState(false);\n\n  const handleClose = () => setShow(false);\n\n  const handleShow = () => setShow(true);\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Button, {\n    variant: \"primary\",\n    onClick: handleShow,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 7\n    }\n  }, \"About\"), /*#__PURE__*/React.createElement(Modal, {\n    show: show,\n    onHide: handleClose,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Modal.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 11\n    }\n  }, \"About Ladder of Babel\")), /*#__PURE__*/React.createElement(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 9\n    }\n  }, \"Ladder of Babel is a tool for beginner and intermediate students of Chinese that makes any text accessible by solving a basic problem with most current tools.\", /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 49\n    }\n  }), \"Tools such as the Google Translate browser plugin, or the similar Mate Translate, are great for translating a single word at a time. They are an enormous improvement over having to search through a paper dictionary. However, they are still designed for people who only need to look up words one by one, whereas most Chinese language learners both need to translate \", /*#__PURE__*/React.createElement(\"b\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216,\n      columnNumber: 65\n    }\n  }, \"most\"), \" of the words - and, likely don't even know which combinations of characters\", /*#__PURE__*/React.createElement(\"b\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 217,\n      columnNumber: 12\n    }\n  }, \" form\"), \" a single word.\", /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 217,\n      columnNumber: 39\n    }\n  }), \"Ladder of Babel solves both of these problems by pre-identifying which characters go together, and giving definitions for everything, at once -- further allowing each user to customize and focus their learning, by hiding any information they don't need, and allowing them to watch as their vocabulary grows. This makes the reading experience as seamless and fluent as possible even for early stage students, and opens up the entire world of online Chinese text for easy access, and productive study.\"), /*#__PURE__*/React.createElement(Modal.Footer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 224,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    variant: \"primary\",\n    onClick: handleClose,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 225,\n      columnNumber: 11\n    }\n  }, \"Close\"))));\n}\n\nconst LoginButton = () => {\n  const {\n    loginWithRedirect\n  } = useAuth0();\n  return /*#__PURE__*/React.createElement(Button, {\n    onClick: () => loginWithRedirect(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 237,\n      columnNumber: 10\n    }\n  }, \"Log In\");\n};\n\nconst LogoutButton = () => {\n  const {\n    logout\n  } = useAuth0();\n  return /*#__PURE__*/React.createElement(Button, {\n    onClick: () => logout({\n      returnTo: window.location.origin\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 244,\n      columnNumber: 5\n    }\n  }, \"Log Out\");\n};\n\nconst Profile = () => {\n  const {\n    user,\n    isAuthenticated\n  } = useAuth0(); // const [userMetadata, setUserMetadata] = useState(null);\n\n  if (isAuthenticated) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 255,\n        columnNumber: 13\n      }\n    }); // <h4 style={{paddingTop:20+'px'}}>Welcome back, {user.name}!</h4>)\n  } else {\n    // return (<h4 className=\"welcome\" >Welcome! Log in, to keep track of your vocabulary!</h4>)\n    return /*#__PURE__*/React.createElement(Button, {\n      style: {\n        marginTop: 20 + 'px'\n      },\n      onClick: () => loginWithRedirect(),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 258,\n        columnNumber: 13\n      }\n    }, \"Welcome! Log in, to keep track of your vocabulary!\");\n  }\n};\n\nconst App = () => {\n  const {\n    user,\n    isAuthenticated,\n    isLoading\n  } = useAuth0(); // const token = (async () => { await getAccessTokenSilently(); })();\n  // const [userMetadata, setUserMetadata] = useState(null);\n  // useEffect(() => {\n  //   const getUserMetadata = async () => {\n  //     const domain = \"ladderofbabel.com\";\n  //     try {\n  //       const accessToken = await getAccessTokenSilently({\n  //         audience: `http://${domain}/api/private`,\n  //         scope: \"read:current_user\",\n  //       });\n  //     } catch (e) {\n  //       console.log(e.message);\n  //     }\n  //   } \n  // })\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"App\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 284,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Navbar, {\n    bg: \"dark\",\n    className: \"\",\n    expand: \"lg\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 285,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Nav.Link, {\n    href: \"http://dovecoteinstitute.org\",\n    style: {\n      color: 'white',\n      fontsize: 24 + 'pt'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 286,\n      columnNumber: 9\n    }\n  }, \"Dovecote Institute\"), !isAuthenticated && /*#__PURE__*/React.createElement(LoginButton, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 287,\n      columnNumber: 30\n    }\n  }), isAuthenticated && /*#__PURE__*/React.createElement(LogoutButton, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 288,\n      columnNumber: 29\n    }\n  }), /*#__PURE__*/React.createElement(Nav, {\n    className: \"mr-auto\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 289,\n      columnNumber: 9\n    }\n  }), \" \", \"\\xA0\", /*#__PURE__*/React.createElement(About, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 291,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(Navbar.Brand, {\n    href: \"#home\",\n    style: {\n      color: 'white',\n      paddingLeft: 20 + 'px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 292,\n      columnNumber: 9\n    }\n  }, \"The Design Philosophy of Ladder of Babel\")), /*#__PURE__*/React.createElement(Profile, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 295,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 297,\n      columnNumber: 7\n    }\n  }), !isAuthenticated && !isLoading && /*#__PURE__*/React.createElement(Translation, {\n    authenticated: isAuthenticated,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 299,\n      columnNumber: 44\n    }\n  }), isAuthenticated && !isLoading && /*#__PURE__*/React.createElement(Translation, {\n    authenticated: isAuthenticated,\n    user: user.email,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 301,\n      columnNumber: 9\n    }\n  }) // gettoken={accessToken} />\n  , /*#__PURE__*/React.createElement(\"hr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 307,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"footer\", {\n    style: {\n      textAlign: \"left\"\n    },\n    className: \"container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 308,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 309,\n      columnNumber: 9\n    }\n  }, \"\\xA9 Dovecote Institute 2020\")));\n};\n\nfunction Authenticator() {\n  return /*#__PURE__*/React.createElement(Auth0Provider, {\n    domain: \"dev-lstkwpc9.us.auth0.com\",\n    clientId: \"AK5e52F3h6Goesct1Q9ADvHuPchBW25U\",\n    redirectUri: window.location.origin,\n    audience: \"http://ladderofbabel.com/api\",\n    scope: \"read:current_user update:current_user_metadata\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 317,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(App, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 324,\n      columnNumber: 7\n    }\n  }));\n} // export default App;\n\n\nexport default Authenticator; // “我有两张自拍，一张很丑，另一张还是很丑”（“在我的后园，可以看见墙外有两株树，一株是枣树，还有一株也是枣树。”——迅哥原文）\n// 100年前的鲁迅万万没有预料到，自己在当下的符号是“中文互联网梗王”、“金句界顶流”。\n// 在各种社会热点的留言评论区，在各大平台的鸡汤文学里，鲁迅语录随处可见；无论搭不搭边，“鲁迅曾经说过”就在那里，从不缺席。\n// 北京鲁迅博物馆为此专门建了一个检索系统，在这里，所有“鲁迅说过的话”都可以被验证或者打脸，该系统还不止一次因为查询人数过多而崩溃。\n// 在互联网的迷幻国度里，人人以为自己熟读鲁迅。\n// 人人不知道的是，这个活在100年前的老男孩，早早已将我们读懂、看透。","map":{"version":3,"sources":["/Users/amloewi/Code/ladder-of-babel/src/App.js"],"names":["React","useState","cedict","Container","Row","Col","Navbar","Button","Nav","Modal","InputGroup","FormControl","axios","Auth0Provider","useAuth0","Translation","Component","constructor","props","translation","state","text","known","unknown","length","vocabulary","authenticated","get","user","then","result","updated","map","word","data","includes","show","reduce","a","b","handleInputChange","bind","event","e","target","value","setState","translate","j","toggle","ix","post","remaining_characters","word_boundary","best_candidate","candidate","slice","line","String","pinyin","split","definition","push","render","span","offset","paddingTop","textAlign","About","setShow","handleClose","handleShow","LoginButton","loginWithRedirect","LogoutButton","logout","returnTo","window","location","origin","Profile","isAuthenticated","marginTop","App","isLoading","color","fontsize","paddingLeft","email","Authenticator"],"mappings":"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","sourcesContent":["import React, { useState } from 'react';\nimport './App.css';\nimport { cedict } from \"./medium.js\"; // do one for medium w ... 50k\nimport '../node_modules/bootstrap/dist/css/bootstrap.min.css'; // This was necessary; ugh\nimport { Container, Row, Col, Navbar, Button, Nav, Modal, InputGroup, FormControl } from 'react-bootstrap';\nimport axios from 'axios';\nimport { Auth0Provider, useAuth0 } from \"@auth0/auth0-react\";\n\n// dev-lstkwpc9.us.auth0.com # DOMAIN\n// AK5e52F3h6Goesct1Q9ADvHuPchBW25U # CLIENT ID\n\nclass Translation extends React.Component {\n  constructor(props) {\n    super(props);\n    const translation = [\n    {\"word\":\"在\", \"pinyin\":\"[zai4]\", \"definition\": \"/(located) at/(to be) in/to exist/in the middle of doing sth/(indicating an action in progress)/\"},\n    {\"word\":\"此\", \"pinyin\":\"[ci3]\", \"definition\": \"/this/these/\"},\n    {\"word\":\"粘贴\", \"pinyin\":\"[zhan1 tie1]\", \"definition\":\"/to stick/to affix/to adhere/to paste (as in 'copy and paste')/Taiwan pr. [nian2 tie1]/also written 黏貼|黏贴[nian2 tie1]/\"},\n    {\"word\":\"你\", \"pinyin\":\"[ni3]\", \"definition\": \"/you (informal, as opposed to courteous 您[nin2])/\"},\n    {\"word\":\"自己\", \"pinyin\":\"[zi4 ji3]\", \"definition\": \"/oneself/one's own/\"},\n    {\"word\":\"的\", \"pinyin\":\"[de5]\", \"definition\": \"/of/~'s (possessive particle)/(used after an attribute)/(used to form a nominal expression)/(used at the end of a declarative sentence for emphasis)/\"},\n    {\"word\":\"内容\", \"pinyin\":\"[nei4 rong2]\", \"definition\": \"/content/substance/details/CL:個|个[ge4],項|项[xiang4]/\"},\n    {\"word\":\"!\", \"pinyin\":\"\", \"definition\": \"\"}\n  ]\n\n    // IS IT BECAUSE THE MEANING OF 'this' IS CHANGING INSIDE OF THE CALL???\n    // Well don't know, but putting this outside (as the default)\n    // and only conditionally doing the authenticated version worked.\n    this.state = {\n      translation: translation,\n      text: \"在此粘贴你自己的内容!\",\n      known: 0,\n      unknown: translation.length,\n      vocabulary: [],\n    };\n\n    if (this.props.authenticated) {\n      // console.log(\"Set state YES authenticated\")\n      axios.get(\"https://ladder-pipenv.herokuapp.com/api/private/\" + this.props.user + \"/mandarin\").then(\n        result => {\n          // console.log(\"result.data:\", result.data)\n          const updated = translation.map((word) => {\n            if (result.data.includes(word)) {\n              return {...word, show: \"hidden\"}\n            } else {\n              return word\n            }\n          })\n          this.state = {\n            translation: updated, \n            text: \"在此粘贴你自己的内容!\",\n            vocabulary: result.data,\n            known: result.data.length,\n            unknown: updated.map(word => word[\"show\"]!==\"hidden\").reduce((a, b) => a + b)\n          };\n        }\n      )\n    }\n    // Would prefer the less insane syntax for this\n    this.handleInputChange = this.handleInputChange.bind(this)\n    // Why again do I need to declare this, and not 'toggle'? B/c event?\n  }\n\n  handleInputChange(event) {\n    // event.persist()\n    const e = event.target.value\n    if (this.props.authenticated) {\n      axios.get(\"https://ladder-pipenv.herokuapp.com/api/private/\" + this.props.user + \"/mandarin\").then(\n      result => {\n        this.setState({\n          vocabulary: result.data, // yes! This works!\n          text: e, // vent.target.value,\n          known: result.data.length,\n          translation: this.translate(e).map((word, j) => {\n            if (result.data.includes(word.word)) {\n              return {...word, show: \"hidden\"}\n            } else {\n              return {...word, show: \"\"}\n            }\n          })\n        })\n      })\n    } else {\n      this.setState({\n        // vocabulary: result.data, // yes! This works!\n        text: e, // vent.target.value,\n        known: 0, // result.data.length,\n        translation: this.translate(e)\n      })\n    }\n  }\n\n  toggle(ix) {\n    const updated = this.state.translation.map((word, j) => {\n      if (ix===j) {\n        return {...word, show: word.show === \"hidden\" ? \"\" : \"hidden\"}\n      } else {\n        return word\n      }\n    })\n    const known = this.state.known + 1 * (updated[ix].show===\"hidden\") + -1 * (updated[ix].show!==\"hidden\")\n\n    this.setState({\n      translation: updated,\n      known: known, \n      unknown: updated.map(word => word[\"show\"]!==\"hidden\").reduce((a, b) => a + b)\n    })\n\n    if (this.props.authenticated) {\n      // https://ladder-pipenv.herokuapp.com/\n      // http://127.0.0.1:5000/api/private/\n      axios.post(\"https://ladder-pipenv.herokuapp.com/api/private/\" + this.props.user + \"/mandarin/\" + this.state.translation[ix].word //,\n      // {\n      //   headers: {\n      //     Authorization: `Bearer ${token}`,\n      //   }\n      // }\n      )\n    }\n  }\n\n  // Shit -- this should be calling the database too at ... /language/word, to just get it? \n  translate(text) { \n    const translation = []\n    let remaining_characters = text\n    while (remaining_characters.length > 0) {\n        let word_boundary = 1\n        let best_candidate = null\n        while (remaining_characters.length > 0) {\n            const candidate = remaining_characters.slice(0, word_boundary)\n            if ((candidate in cedict) && (word_boundary <= remaining_characters.length)) {\n                best_candidate = candidate\n                word_boundary += 1\n            } else {  // candidate is NOT in the dictionary\n                if (best_candidate != null) {  // at least the first character was recognized\n                  const line = String(cedict[best_candidate])\n                  const pinyin = (line.split(/](.+)/)[0]) + \"]\" // I only want to split on the FIRST ']'; \n                  const definition = (line.split(/](.+)/)[1]).slice(1) \n                  translation.push({\"word\": best_candidate, \"pinyin\": pinyin, \"definition\": definition})\n                } else {\n                    const word = remaining_characters[0]\n                    translation.push({\"word\": word, \"pinyin\": \"\", \"definition\": \"\"})\n                }\n                if (word_boundary > 1) {\n                    remaining_characters = remaining_characters.slice(word_boundary-1)\n                } else {\n                    remaining_characters = remaining_characters.slice(word_boundary)\n                }\n                break\n            }\n        }\n    }\n    return(translation)\n  }\n\n  render() {  \n    return(\n      <Container>\n          \n        <Row>\n          <Col md={{span:3, offset:9}} className=\"fixed-top\">\n            <Button variant=\"dark\">Click to hide familiar words</Button>\n            <br></br>\n            <h5 style={{paddingTop:10+\"px\"}}>You knew {this.state.known} words,</h5>\n            <h5>and saw {this.state.unknown} new ones!</h5>\n          </Col>\n        </Row>\n\n        <Row>\n          <Col md={10} className=\"textinput\">\n            <InputGroup>\n              <InputGroup.Prepend>\n                <InputGroup.Text>\n                  Paste Chinese Here            \n                </InputGroup.Text>\n              </InputGroup.Prepend>\n              <FormControl onChange={ this.handleInputChange } value={ this.state.text }/>\n            </InputGroup>\n            &nbsp;&nbsp;\n          </Col>\n        </Row>\n\n        {this.state.translation.map((word, ix) =>\n          <Row key={ix} style={{textAlign: \"left\"}} onClick={() => this.toggle(ix)}>\n            <Col md={1}>{word[\"word\"]}</Col>\n            <Col md={2} className={word[\"show\"]}>{word[\"pinyin\"]}</Col>\n            <Col md={8} className={word[\"show\"]}>{word[\"definition\"]}</Col>\n          </Row>\n        )}\n      </Container>\n    ) \n  }\n}\n\nfunction About() {\n  const [show, setShow] = useState(false);\n  const handleClose = () => setShow(false);\n  const handleShow = () => setShow(true);\n\n  return (\n    <>\n      <Button variant=\"primary\" onClick={handleShow}>\n        About\n      </Button>\n\n      <Modal show={show} onHide={handleClose}>\n        <Modal.Header closeButton>\n          <Modal.Title>About Ladder of Babel</Modal.Title>\n        </Modal.Header>\n        <Modal.Body>\n          Ladder of Babel is a tool for beginner and intermediate students of Chinese that makes any text accessible by solving a \n          basic problem with most current tools.<p></p>\n          Tools such as the Google Translate browser plugin, or the similar Mate Translate, are great for translating a single word at a time. They are \n           an enormous improvement over having to search through a paper dictionary. However, they are still designed for people who only need to look up\n          words one by one, whereas\n          most Chinese language learners both need to translate <b>most</b> of the words - and, likely don't even know which combinations of characters \n           <b> form</b> a single word.<p></p>\n           Ladder of Babel solves both of these problems by pre-identifying which characters go together, and giving definitions for everything, at once -- \n           further allowing each user to customize and focus their learning, by hiding any information they don't need, and allowing them to watch as their\n           vocabulary grows.\n           This makes the reading experience as seamless and fluent as possible even for early stage students, and opens up the entire world of online Chinese\n           text for easy access, and productive study.\n        </Modal.Body>\n        <Modal.Footer>\n          <Button variant=\"primary\" onClick={handleClose}>\n            Close\n          </Button>\n        </Modal.Footer>\n      </Modal>\n    </>\n  );\n}\n\nconst LoginButton = () => {\n  const { loginWithRedirect } = useAuth0();\n\n  return <Button onClick={() => loginWithRedirect()}>Log In</Button>;\n};\n\nconst LogoutButton = () => {\n  const { logout } = useAuth0();\n\n  return (\n    <Button onClick={() => logout({ returnTo: window.location.origin })}>\n      Log Out\n    </Button>\n  );\n};\n\nconst Profile = () => {\n  const { user, isAuthenticated } = useAuth0();\n  // const [userMetadata, setUserMetadata] = useState(null);\n\n  if (isAuthenticated) {\n    return (<div></div>) // <h4 style={{paddingTop:20+'px'}}>Welcome back, {user.name}!</h4>)\n  } else {\n    // return (<h4 className=\"welcome\" >Welcome! Log in, to keep track of your vocabulary!</h4>)\n    return (<Button style={{marginTop:20+'px'}} onClick={() => loginWithRedirect()} >Welcome! Log in, to keep track of your vocabulary!</Button>)\n  }\n};\n\nconst App = () => {\n  \n  const { user, isAuthenticated, isLoading } = useAuth0();\n  // const token = (async () => { await getAccessTokenSilently(); })();\n  // const [userMetadata, setUserMetadata] = useState(null);\n\n  // useEffect(() => {\n  //   const getUserMetadata = async () => {\n  //     const domain = \"ladderofbabel.com\";\n  \n  //     try {\n  //       const accessToken = await getAccessTokenSilently({\n  //         audience: `http://${domain}/api/private`,\n  //         scope: \"read:current_user\",\n  //       });\n  //     } catch (e) {\n  //       console.log(e.message);\n  //     }\n  //   } \n  // })\n\n  return (\n    <div className=\"App\">\n      <Navbar bg=\"dark\" className=\"\" expand=\"lg\">\n        <Nav.Link href=\"http://dovecoteinstitute.org\" style={{color:'white', fontsize:24+'pt'}}>Dovecote Institute</Nav.Link>\n        {!isAuthenticated && <LoginButton />}\n        {isAuthenticated && <LogoutButton />}\n        <Nav className=\"mr-auto\"></Nav> {/* Using this to push the rest to the right */}\n        &nbsp;\n        <About />        \n        <Navbar.Brand href=\"#home\" style={{color:'white', paddingLeft:20+'px'}}>The Design Philosophy of Ladder of Babel</Navbar.Brand>        \n      </Navbar>\n\n      <Profile />\n\n      <p></p>      \n      {/* <Translation authenticated={isAuthenticated} user={user.email} /> */}\n      {(!isAuthenticated && !isLoading) && <Translation authenticated={isAuthenticated} />}\n      {(isAuthenticated && !isLoading) && \n        <Translation \n          authenticated={isAuthenticated} \n          user={user.email} />\n          // gettoken={accessToken} />\n      }\n\n      <hr></hr>\n      <footer style={{textAlign: \"left\"}} className=\"container\">\n        <p>&copy; Dovecote Institute 2020</p>\n      </footer>\n    </div>\n  );\n}\n\nfunction Authenticator() {\n  return (\n    <Auth0Provider\n    domain=\"dev-lstkwpc9.us.auth0.com\"\n    clientId=\"AK5e52F3h6Goesct1Q9ADvHuPchBW25U\"\n    redirectUri={window.location.origin}\n    audience=\"http://ladderofbabel.com/api\"\n    scope=\"read:current_user update:current_user_metadata\"\n    >\n      <App />\n    </Auth0Provider>\n\n  )\n}\n\n// export default App;\nexport default Authenticator;\n\n\n// “我有两张自拍，一张很丑，另一张还是很丑”（“在我的后园，可以看见墙外有两株树，一株是枣树，还有一株也是枣树。”——迅哥原文）\n// 100年前的鲁迅万万没有预料到，自己在当下的符号是“中文互联网梗王”、“金句界顶流”。\n// 在各种社会热点的留言评论区，在各大平台的鸡汤文学里，鲁迅语录随处可见；无论搭不搭边，“鲁迅曾经说过”就在那里，从不缺席。\n// 北京鲁迅博物馆为此专门建了一个检索系统，在这里，所有“鲁迅说过的话”都可以被验证或者打脸，该系统还不止一次因为查询人数过多而崩溃。\n// 在互联网的迷幻国度里，人人以为自己熟读鲁迅。\n// 人人不知道的是，这个活在100年前的老男孩，早早已将我们读懂、看透。"]},"metadata":{},"sourceType":"module"}